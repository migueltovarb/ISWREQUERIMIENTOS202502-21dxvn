{% extends 'core/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">Procesar Pago</h4>
            </div>
            <div class="card-body">
                <!-- Informaci√≥n del curso -->
                <div class="alert alert-info">
                    <h5>Resumen de la inscripci√≥n</h5>
                    <p><strong>Curso:</strong> {{ enrollment.course.code }} - {{ enrollment.course.name }}</p>
                    <p><strong>Cr√©ditos:</strong> {{ enrollment.course.credits }}</p>
                    <p><strong>Valor por cr√©dito:</strong> $100,000</p>
                    <p><strong>Total a pagar:</strong> ${{ enrollment.course.credits|add:0|mul:100000|floatformat:0 }}</p>
                </div>

                {% if payment and payment.status == 'completed' %}
                <div class="alert alert-success">
                    <h5>‚úÖ Pago ya procesado</h5>
                    <p>Tu pago fue procesado exitosamente el {{ payment.created_at|date:"d/m/Y" }}.</p>
                    <p><strong>N√∫mero de transacci√≥n:</strong> {{ payment.transaction_id }}</p>
                    <a href="{% url 'my_enrollments' %}" class="btn btn-success">Volver a mis inscripciones</a>
                </div>
                {% else %}
                <!-- Formulario de pago simulado -->
                <form method="post" action="{% url 'process_payment' enrollment.id %}">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <h5>M√©todo de pago</h5>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="pse" value="pse" checked>
                            <label class="form-check-label" for="pse">
                                üí≥ PSE (Pagos Seguros en L√≠nea)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="credit_card" value="credit_card">
                            <label class="form-check-label" for="credit_card">
                                üí≥ Tarjeta de Cr√©dito
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="debit_card" value="debit_card">
                            <label class="form-check-label" for="debit_card">
                                üí≥ Tarjeta de D√©bito
                            </label>
                        </div>
                    </div>

                    <!-- Informaci√≥n de pago simulada -->
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è Simulaci√≥n de Pago</h6>
                        <p class="mb-0">Este es un entorno de prueba. No se realizar√°n cargos reales.</p>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success btn-lg">
                            üí≥ Procesar Pago de ${{ enrollment.course.credits|add:0|mul:100000|floatformat:0 }}
                        </button>
                        <a href="{% url 'my_enrollments' %}" class="btn btn-secondary">Cancelar</a>
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
